# ğŸ’ª GymBuddy â€” å€‹äººå¥èº«è¨“ç·´è¿½è¹¤å™¨

> å‹•ä½œåº« Ã— è¨“ç·´è¨ˆåŠƒ Ã— ä¸»å‹•è¨“ç·´ Ã— æ¼¸é€²è¶…è² è·å»ºè­°ï¼Œä¸€ç«™å¼å¥èº«ç®¡ç†å·¥å…·ã€‚

![Dashboard](photo/image.png)

---

## ç›®éŒ„

- [åŠŸèƒ½æ¦‚è¦½](#åŠŸèƒ½æ¦‚è¦½)
- [ç•«é¢æˆªåœ–](#ç•«é¢æˆªåœ–)
- [ä½¿ç”¨æµç¨‹](#ä½¿ç”¨æµç¨‹)
- [æ¼¸é€²è¶…è² è·æ¼”ç®—æ³•](#æ¼¸é€²è¶…è² è·æ¼”ç®—æ³•)
- [æŠ€è¡“æ¶æ§‹](#æŠ€è¡“æ¶æ§‹)
- [è³‡æ–™åº«çµæ§‹](#è³‡æ–™åº«çµæ§‹)
- [æœ¬åœ°é–‹ç™¼](#æœ¬åœ°é–‹ç™¼)
- [Docker éƒ¨ç½²](#docker-éƒ¨ç½²)
- [ç›®éŒ„çµæ§‹](#ç›®éŒ„çµæ§‹)

---

## åŠŸèƒ½æ¦‚è¦½

| æ¨¡çµ„ | åŠŸèƒ½ |
|------|------|
| ğŸ  **é¦–é å„€è¡¨æ¿** | æœ¬é€±è¨“ç·´æ¬¡æ•¸ã€å€‹äººæœ€ä½³ç´€éŒ„ (PR)ã€å¿«é€Ÿé–‹å§‹ |
| ğŸ“š **å‹•ä½œåº«** | 79+ å€‹å‹•ä½œï¼ŒGIF ç¤ºç¯„ã€æ­¥é©Ÿèªªæ˜ã€æŒ‰è‚Œç¾¤/å™¨æ/é›£åº¦ç¯©é¸ |
| ğŸ“‹ **è¨“ç·´è¨ˆåŠƒ** | è‡ªè¨‚å¤šæ—¥åˆ†åŒ–è¨ˆåŠƒï¼ˆPPL ç­‰ï¼‰ï¼Œæ¯æ—¥å‹•ä½œ/çµ„æ•¸/æ¬¡æ•¸/é‡é‡è¨­å®š |
| â–¶ï¸ **ä¸»å‹•è¨“ç·´** | çµ„é–“ä¼‘æ¯å€’æ•¸è¨ˆæ™‚ã€Â±2.5kg å¿«é€Ÿèª¿é‡ã€å™¨æè¢«ä½”ç”¨æ™‚åˆ‡æ›æ›¿ä»£å‹•ä½œ |
| ğŸ“Š **è¨“ç·´è¨˜éŒ„** | æ­·å²ç´€éŒ„æŸ¥é–±ã€è¨“ç·´é‡è¶¨å‹¢åœ–è¡¨ã€å–®çµ„ç·¨è¼¯/åˆªé™¤ |
| ğŸ¯ **æ¼¸é€²è¶…è² è·** | æ ¹æ“šæ­·å²æ•¸æ“šè‡ªå‹•æ¨è–¦ä¸‹æ¬¡ç›®æ¨™é‡é‡ |

---

## ç•«é¢æˆªåœ–

### é¦–é  â€” å„€è¡¨æ¿
è¨“ç·´æ¦‚æ³ã€æœ¬é€±çµ±è¨ˆã€å€‹äººè¨ˆåŠƒåˆ—è¡¨ï¼Œä»¥åŠå„å‹•ä½œå€‹äººæœ€ä½³ç´€éŒ„ (1RM ä¼°ç®—)ã€‚

![é¦–é å„€è¡¨æ¿](photo/image.png)

---

### å‹•ä½œåº«
79+ å€‹å‹•ä½œï¼Œæ”¯æ´é—œéµå­—æœå°‹ã€é›£åº¦ç¯©é¸ã€è‚Œç¾¤ç¯©é¸ï¼Œæœ‰ GIF çš„å‹•ä½œæœƒé¡¯ç¤º `GIF` æ¨™ç±¤ã€‚

![å‹•ä½œåº«](photo/image1.png)

---

### è¨“ç·´è¨ˆåŠƒåˆ—è¡¨
é¡¯ç¤ºæ‰€æœ‰è¨“ç·´è¨ˆåŠƒï¼ŒåŒ…å«è¨“ç·´æ—¥å¤©æ•¸èˆ‡å„æ—¥å‹•ä½œæ‘˜è¦ï¼Œå¯å¿«é€Ÿç€è¦½å…¨å±€å®‰æ’ã€‚

![è¨“ç·´è¨ˆåŠƒ](photo/image2.png)

---

### è¨ˆåŠƒè©³æƒ…
é»é–‹è¨ˆåŠƒå¯çœ‹åˆ°å„è¨“ç·´æ—¥çš„å®Œæ•´å‹•ä½œæ¸…å–®ï¼Œå«é è¨­çµ„æ•¸ã€æ¬¡æ•¸ç¯„åœã€å»ºè­°é‡é‡ï¼Œä¸¦å¯ç›´æ¥ã€Œé–‹å§‹è¨“ç·´ã€ã€‚

![è¨ˆåŠƒè©³æƒ…](photo/image3.png)

---

### ä¸»å‹•è¨“ç·´ä»‹é¢
è¨“ç·´æ ¸å¿ƒé é¢ï¼šå‹•ä½œåœ–ç¤ºï¼ˆGIF/éœæ…‹åœ–ï¼‰ï¼‹æ­¥é©Ÿèªªæ˜ã€Â±2.5 / Â±5 kg å¿«é€Ÿèª¿é‡ã€æ¬¡æ•¸èª¿æ•´ã€å®Œæˆçµ„æ•¸æŒ‰éˆ•ã€‚

![ä¸»å‹•è¨“ç·´](photo/image4.png)

---

### çµ„é–“ä¼‘æ¯è¨ˆæ™‚å™¨
å®Œæˆä¸€çµ„å¾Œè‡ªå‹•é€²å…¥ä¼‘æ¯å€’æ•¸ï¼ŒSVG åœ“åœˆå‹•ç•«é¡¯ç¤ºå‰©é¤˜æ™‚é–“ï¼Œæ”¯æ´ã€Œè·³éä¼‘æ¯ã€ï¼Œè¡Œå‹•è£ç½®å®Œæˆæ™‚éœ‡å‹•æé†’ã€‚

![ä¼‘æ¯è¨ˆæ™‚](photo/image5.png)

---

### è¨“ç·´è¨˜éŒ„
æŸ¥çœ‹å®Œæ•´èˆ‡æœªå®Œæˆçš„æ­·å²è¨“ç·´ï¼Œè¨“ç·´é‡è¶¨å‹¢æŠ˜ç·šåœ–ï¼ˆ7å¤©/30å¤©/90å¤©ï¼‰ï¼Œå¯å±•é–‹æŸ¥çœ‹æ¯çµ„è©³æƒ…ä¸¦é€²è¡Œç·¨è¼¯æˆ–åˆªé™¤ã€‚

![è¨“ç·´è¨˜éŒ„](photo/image6.png)

---

## ä½¿ç”¨æµç¨‹

```mermaid
flowchart TD
    A([ç™»å…¥ / è¨»å†Š]) --> B[é¦–é å„€è¡¨æ¿]
    B --> C{é¸æ“‡æ“ä½œ}

    C --> D[å‹•ä½œåº«]
    D --> D1[æœå°‹/ç¯©é¸å‹•ä½œ]
    D1 --> D2[æŸ¥çœ‹ GIF + æ­¥é©Ÿèªªæ˜]
    D2 --> D3[æŸ¥çœ‹æ›¿ä»£å‹•ä½œ]

    C --> E[è¨“ç·´è¨ˆåŠƒ]
    E --> E1[æ–°å¢è¨ˆåŠƒ]
    E1 --> E2[å»ºç«‹è¨“ç·´æ—¥]
    E2 --> E3[åŠ å…¥å‹•ä½œ & è¨­å®šçµ„æ•¸/é‡é‡]

    C --> F[é–‹å§‹è¨“ç·´]
    E --> F
    F --> G[é¸æ“‡è¨ˆåŠƒèˆ‡è¨“ç·´æ—¥]
    G --> H[ä¸»å‹•è¨“ç·´ä»‹é¢]

    H --> I{å®Œæˆä¸€çµ„}
    I --> J[è¨˜éŒ„é‡é‡ & æ¬¡æ•¸]
    J --> K[ä¼‘æ¯è¨ˆæ™‚å™¨å€’æ•¸]
    K --> L{è¨ˆæ™‚çµæŸ}
    L -->|ç¹¼çºŒä¸‹ä¸€çµ„| H
    L -->|å™¨æè¢«ä½”ç”¨| M[åˆ‡æ›æ›¿ä»£å‹•ä½œ]
    M --> H

    H --> N{æ‰€æœ‰å‹•ä½œå®Œæˆ}
    N --> O[è¨“ç·´å®Œæˆç¸½çµ]
    O --> P[æ¼¸é€²è¶…è² è·å»ºè­°]
    P --> B

    C --> Q[è¨“ç·´è¨˜éŒ„]
    Q --> R[æŸ¥çœ‹æ­·å² & åœ–è¡¨]
    R --> S[ç·¨è¼¯/åˆªé™¤å–®çµ„ç´€éŒ„]
```

---

## æ¼¸é€²è¶…è² è·æ¼”ç®—æ³•

æ¯æ¬¡è¨“ç·´å®Œæˆå¾Œï¼Œç³»çµ±æœƒæ ¹æ“šæ­·å²æ•¸æ“šè‡ªå‹•è¨ˆç®—ä¸‹æ¬¡å»ºè­°ï¼š

```mermaid
flowchart TD
    A[è¨“ç·´å®Œæˆ] --> B{å…¨éƒ¨çµ„æ•¸å®Œæˆï¼Ÿ}

    B -->|å¦| C[å»ºè­°æ¸›é‡ ~7.5%\nå…ˆéå›ºå‹•ä½œæŠ€è¡“]

    B -->|æ˜¯| D{é”åˆ°æ¬¡æ•¸ä¸Šé™ï¼Ÿ}

    D -->|å¦| E[ç¶­æŒé‡é‡\nç¹¼çºŒåŠªåŠ›çªç ´]

    D -->|æ˜¯| F[å»ºè­°å¢åŠ é‡é‡\n+2.5 kg æˆ– +1.25 kg]

    F --> G{æª¢æ¸¬è¿‘3æ¬¡æ­·å²}
    G -->|ç™¼ç¾éæ¸›å‚¾å‘| H[å»ºè­°æ”¹ç”¨\nReverse Pyramid è¨“ç·´æ³•]
    G -->|ç©©å®šé€²æ­¥| I[ç›´ç·šæ¼¸é€²]
```

**1RM ä¼°ç®—å…¬å¼ï¼ˆEpleyï¼‰ï¼š**

```
1RM = é‡é‡ Ã— (1 + æ¬¡æ•¸ / 30)
```

---

## æŠ€è¡“æ¶æ§‹

```mermaid
graph TB
    subgraph Client["ç€è¦½å™¨ / è¡Œå‹•è£ç½®"]
        UI[Next.js App Router\nReact 18 + TypeScript]
        SW[Service Worker\nèƒŒæ™¯ä¼‘æ¯æé†’é€šçŸ¥]
    end

    subgraph Server["Docker å®¹å™¨ â€” workout-app"]
        SA[Server Actions\nç™»å…¥ / ç™»å‡º / è¨»å†Š]
        API[REST API Routes\n/api/exercises, /api/plans\n/api/sessions, /api/history]
        AUTH[HMAC Cookie Session\nsignSession / verifySession]
        PO[æ¼¸é€²è¶…è² è·å¼•æ“\nprogressive-overload.ts]
    end

    subgraph DB["Docker å®¹å™¨ â€” workout-db"]
        PG[(PostgreSQL 16)]
        PRISMA[Prisma ORM]
    end

    subgraph Infra["åŸºç¤è¨­æ–½"]
        CF[Cloudflare Tunnel\ngym.example.com]
    end

    UI -->|HTTP| SA
    UI -->|fetch| API
    SA --> AUTH
    API --> AUTH
    API --> PRISMA
    SA --> PRISMA
    PRISMA --> PG
    API --> PO
    CF -->|åå‘ä»£ç†| UI
    SW -.->|Notification API| UI
```

### æŠ€è¡“é¸å‹

| å±¤ç´š | æŠ€è¡“ |
|------|------|
| å‰ç«¯æ¡†æ¶ | Next.js 14 (App Router, Server Components) |
| èªè¨€ | TypeScript |
| æ¨£å¼ | Tailwind CSS + shadcn/ui |
| åœ–è¡¨ | Recharts |
| ORM | Prisma |
| è³‡æ–™åº« | PostgreSQL 16 |
| èªè­‰ | HMAC ç°½å Cookie Session + argon2id å¯†ç¢¼é›œæ¹Š |
| éƒ¨ç½² | Docker Compose |
| å¤–ç¶²ç©¿é€ | Cloudflare Tunnel |
| èƒŒæ™¯é€šçŸ¥ | Web Audio API + Service Worker |

---

## è³‡æ–™åº«çµæ§‹

```mermaid
erDiagram
    users ||--o{ workout_plans : "æ“æœ‰"
    users ||--o{ workout_sessions : "é€²è¡Œ"
    users ||--o{ personal_records : "å‰µä¸‹"

    workout_plans ||--o{ workout_plan_days : "åŒ…å«"
    workout_plan_days ||--o{ workout_plan_exercises : "åˆ—å‡º"

    exercises ||--o{ workout_plan_exercises : "è¢«å®‰æ’"
    exercises ||--o{ session_exercises : "è¢«åŸ·è¡Œ"
    exercises }o--o{ equipment : "éœ€è¦å™¨æ"
    exercises }o--o{ muscle_groups : "è¨“ç·´è‚Œç¾¤"
    exercises }o--o{ exercises : "æ›¿ä»£å‹•ä½œ"

    workout_sessions ||--o{ session_exercises : "åŒ…å«"
    session_exercises ||--o{ session_sets : "è¨˜éŒ„çµ„æ•¸"

    users {
        string id PK
        string name
        string email
        string passwordHash
        datetime createdAt
    }
    exercises {
        string id PK
        string name
        string exerciseType
        string difficulty
        string gifUrl
        string videoUrl
        json stepInstructions
    }
    workout_sessions {
        string id PK
        string userId FK
        string planId FK
        string dayId FK
        datetime startedAt
        datetime completedAt
    }
    session_sets {
        string id PK
        string sessionExerciseId FK
        int setNumber
        int repsPerformed
        decimal weightKg
        int restAfterSeconds
        datetime completedAt
    }
    personal_records {
        string id PK
        string userId FK
        string exerciseId FK
        decimal weightKg
        int reps
        decimal estimatedOneRepMax
        datetime achievedAt
    }
```

---

## æœ¬åœ°é–‹ç™¼

### å‰ç½®éœ€æ±‚
- Node.js 20+
- PostgreSQLï¼ˆæˆ–ä½¿ç”¨ Dockerï¼‰

### å®‰è£

```bash
git clone https://github.com/hyaochen/GymBuddy.git
cd GymBuddy
npm install
```

### è¨­å®šç’°å¢ƒè®Šæ•¸

```bash
cp .env.example .env
# ç·¨è¼¯ .envï¼Œå¡«å…¥è³‡æ–™åº«é€£ç·šèˆ‡ SESSION_SECRET
```

`.env` ç¯„ä¾‹ï¼š
```env
DATABASE_URL="postgresql://workout:password@localhost:5435/workout"
SESSION_SECRET="your-64-char-random-string"
COOKIE_SECURE="false"
```

### åˆå§‹åŒ–è³‡æ–™åº«

```bash
npx prisma migrate deploy
npx prisma db seed
```

### å•Ÿå‹•é–‹ç™¼ä¼ºæœå™¨

```bash
npm run dev
# http://localhost:3000
```

### å»ºç«‹æ¸¬è©¦å¸³è™Ÿï¼ˆé¸ç”¨ï¼‰

```bash
npx ts-node --compiler-options '{"module":"CommonJS"}' prisma/create-test-account.ts
# å¸³è™Ÿï¼štest  å¯†ç¢¼ï¼štest
```

---

## Docker éƒ¨ç½²

### å¿«é€Ÿå•Ÿå‹•

```bash
# å•Ÿå‹•è³‡æ–™åº« + App
docker compose up -d

# æŸ¥çœ‹ log
docker compose logs -f workout-app

# åœæ­¢
docker compose down
```

App é è¨­ç›£è½ `http://localhost:3005`

### ä½¿ç”¨ç®¡ç†è…³æœ¬ï¼ˆWindowsï¼‰

```bat
gym.bat
```

| é¸é … | åŠŸèƒ½ |
|------|------|
| `[1]` | å•Ÿå‹•å…¨éƒ¨æœå‹™ï¼ˆDB + Appï¼‰ |
| `[2]` | åœæ­¢å…¨éƒ¨æœå‹™ |
| `[3]` | é‡æ–° Build ä¸¦å•Ÿå‹• |
| `[4]` | æŸ¥çœ‹ App å³æ™‚ Log |
| `[5]` | é€²å…¥è³‡æ–™åº« Shell |
| `[6]` | å‚™ä»½è³‡æ–™åº« |

### Cloudflare Tunnelï¼ˆå¤–ç¶²å­˜å–ï¼‰

```bash
docker compose -f docker-compose.tunnel.yml up -d
```

è¨­å®š `~/.cloudflared/gym-docker-config.yml`ï¼š
```yaml
tunnel: <your-tunnel-id>
ingress:
  - hostname: gym.yourdomain.com
    service: http://workout-app:3000
  - service: http_status:404
```

---

## ç›®éŒ„çµæ§‹

```
GymBuddy/
â”œâ”€â”€ docker-compose.yml
â”œâ”€â”€ docker-compose.tunnel.yml
â”œâ”€â”€ Dockerfile
â”œâ”€â”€ gym.bat                        # Windows ç®¡ç†è…³æœ¬
â”œâ”€â”€ prisma/
â”‚   â”œâ”€â”€ schema.prisma
â”‚   â”œâ”€â”€ seed.ts                    # å™¨æ + è‚Œç¾¤ + å‹•ä½œ seed
â”‚   â”œâ”€â”€ add-stretch-and-beginner.ts
â”‚   â””â”€â”€ create-test-account.ts
â””â”€â”€ src/
    â”œâ”€â”€ middleware.ts              # è·¯ç”±ä¿è­·
    â”œâ”€â”€ app/
    â”‚   â”œâ”€â”€ (auth)/                # ç™»å…¥ / è¨»å†Š
    â”‚   â”œâ”€â”€ (app)/
    â”‚   â”‚   â”œâ”€â”€ page.tsx           # é¦–é å„€è¡¨æ¿
    â”‚   â”‚   â”œâ”€â”€ exercises/         # å‹•ä½œåº«
    â”‚   â”‚   â”œâ”€â”€ plans/             # è¨“ç·´è¨ˆåŠƒ
    â”‚   â”‚   â”œâ”€â”€ session/[id]/      # ä¸»å‹•è¨“ç·´
    â”‚   â”‚   â””â”€â”€ history/           # è¨“ç·´è¨˜éŒ„
    â”‚   â””â”€â”€ api/                   # REST API
    â”œâ”€â”€ components/
    â”‚   â”œâ”€â”€ workout/               # RestTimerã€ActiveSet ç­‰
    â”‚   â”œâ”€â”€ charts/                # Recharts åœ–è¡¨
    â”‚   â””â”€â”€ layout/                # BottomNavã€PageHeader
    â””â”€â”€ lib/
        â”œâ”€â”€ session.ts             # HMAC Cookie
        â”œâ”€â”€ auth.ts                # requireAuth()
        â””â”€â”€ progressive-overload.ts
```

---

## é è¨­è¨“ç·´è¨ˆåŠƒ

| è¨ˆåŠƒåç¨± | å¤©æ•¸ | èªªæ˜ |
|----------|------|------|
| 5æ—¥PPLé€²éšè¨ˆåŠƒ | 5å¤© | æ¨/æ‹‰/è…¿é«˜é »åˆ†åŒ–ï¼Œæ¯é€±æ¯è‚Œç¾¤è¨“ç·´2æ¬¡ |
| 5å¤©åˆ†åŒ–è¨“ç·´ | 5å¤© | è…¿ã€ä¸Šè‚¢è¤‡åˆã€æœ‰æ°§æ¢å¾©ã€èƒŒã€è‚©åˆ†åŒ– |
| 3æ—¥PPLæ–°æ‰‹è¨ˆåŠƒ | 3å¤© | é©åˆæ–°æ‰‹ï¼Œä¸­ç­‰é‡é‡è¤‡åˆå‹•ä½œç‚ºä¸» |
| 5æ—¥PPLæ”¾é¬†è¨ˆåŠƒ | 3å¤© | é…åˆé€²éšè¨ˆåŠƒä½¿ç”¨çš„éœæ…‹ä¼¸å±•æ”¾é¬† |

---

## License

MIT
